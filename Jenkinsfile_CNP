#!groovy

@Library("Infrastructure")
import uk.gov.hmcts.contino.ProjectBranch

def type = "java"

def product = "adoption"
def component = "backend"

static Map<String, Object> secret(String secretName, String envVariable) {
  [ $class: 'AzureKeyVaultSecret',
    secretType: 'Secret',
    name: secretName,
    envVariable: envVariable
  ]
}

withPipeline(type, product, component) {

  enableAksStagingDeployment()
  disableLegacyDeployment()
  installCharts()
  enableSlackNotifications('#fpla_adoption_tech')

  env.PROXY_SERVER = "proxyout.reform.hmcts.net:8080"

  before('smoketest:aat') {
      env.URL = "https://adoption-backend-aat.service.core-compute-aat.internal"
    }

  before('smoketest:preview') {
    env.URL="https://adoption-backend-pr-${CHANGE_ID}.service.core-compute-preview.internal"
  }
}
